<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible">
    <title>Exo bonus#01 - Email ?</title>
    <link href="./bootstrap.min.css" rel="stylesheet" />
    <link href="./style.css" rel="stylesheet" />
</head>
<body>
<div class="card">
    <p class="h6 font-weight-bold text-center">Bonus#01 - Vous avez dit email ?</p>
    <div class="instructions">
        <p class="text-secondary">Votre mission si toutefois vous l'acceptez, est de vérifier que le champ saisi 
            correspond bien à une adresse électronique</p>
        <br />
        <p class="text-secondary">On considère un email comme valide si il est de la forme : 
            <pre>firstname.lastname@domain.ext</pre> avec :
        <ul class="text-secondary">
            <li><em>firstname</em> possiblement vide ; dans ce cas, le point séparant firstname de lastname ne doit pas exister>.</li>
            <li><em>lastname</em> doit contenir au moins 3 caractères.</li>
            <li><em>domain</em> doit contenir au moins 6 caractères et précédé de @.</li>
            <li><em>ext</em> (extension) doit contenir de 2 à 4 caractères.</li>
        </ul>
        </p>
        <br />
        <p class="text-success">L'étude de l'objet JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a> 
            et de ses méthodes, plus particulièrement la méthode <em>split(...)</em> 
            (voire la méthode <em>match(...)</em> pour les plus téméraires) sera utile !
        </p>
    </div>

    <br/>
    <label for="mail">Adresse électronique</label>
    <input type="text" id="mail" name="mail" placeholder="Votre adresse électronique" value="firstname.lastname@domain.ext">

    <button type="button" class="btn btn-primary" onclick="checkEmail3()">
        Tester l'adresse électronique
    </button>

</div>

<script type="text/javascript">
    
    // ------------------ 1ère version

    function checkEmail1() {
        
        let email = document.getElementById("mail").value;

        let emailSplit = email.split(".");

        if(emailSplit.length > 1 && emailSplit.length<4 && email.split("@").length!=1){ // On check si on a entre un et deux "." et un seul "@".

            for(i=0;i<emailSplit.length;i++){

                console.log((emailSplit[i].indexOf("@")>2) && ((emailSplit[i].length-1)-emailSplit[i].indexOf("@")>5));

                if((emailSplit[i].indexOf("@")!=(-1) && i!=(emailSplit.length-2)) || (emailSplit[i].split("@").length>2)) { //On vérifie que le "@" n'est pas présent dans le dernier index, ou bien le premier si un firstname est présent

                    return alert("Email incorrecte 1");
                    break;

                } else if((emailSplit[i].indexOf("@")>2) && ((emailSplit[i].length-1)-emailSplit[i].indexOf("@")>5)){  //On vérifie que le "@" est bien encadré par un lastname > 3 et un domaine > 5
                    alert("C'est ok");
                }
            }
        }else{
            return alert("Email incorrecte 3");
        }

    }

    // ------------------ 2ème version

    function checkEmail2(){
        let email = document.getElementById("mail").value;
        let emailAtSplit = email.split("@");

        const MESSAGE_INVALIDE = "Email invalide";
        const MESSAGE_VALIDE = "Email valide"

        // Si l'email ne contient pas "@" ou en contient plus d'un, affichage MESSAGE_INVALIDE
        if(emailAtSplit.length > 2 || emailAtSplit.length == 1){
            alert(MESSAGE_INVALIDE);
            return false;
        }

        /* Split par les "." des valeurs de emailAtSplit */
        let preAt = emailAtSplit[0];
        let postAt = emailAtSplit[1];

        let preAtDotSplit = preAt.split(".");
        let preAtDotSplitLg = preAtDotSplit.length
        let postAtDotSplit = postAt.split(".");

        let lastname = preAtDotSplit[preAtDotSplitLg-1]; //On définit le last name sur le dernier index, index 0 ou 1 suivant si précédé par un firstname ou pas...
        let domain = postAtDotSplit[0];
        let ext = postAtDotSplit[1];

        // Si l'email ne contient pas "@" ou en contient plus d'un, affichage MESSAGE_INVALIDE
        if(preAtDotSplit > 2 || postAtDotSplit > 2){
            alert(MESSAGE_INVALIDE);
            return false;
        }

        // Si l'email à un surname, domain ou extension NC on affiche MESSAGE_INVALIDE
        if((lastname.length)<3 || ext.length>4 || ext.length<2 || domain.length<6){
            alert(MESSAGE_INVALIDE);
            return false;
        }

        return alert(MESSAGE_VALIDE); //On affiche MESSAGE_VALIDE si tous les test ont été passés
    }

    // ------------------ 3ème version

    function checkEmail3(){
        let email = document.getElementById("mail").value;

        if(email.match(/^([a-z0-9][a-z0-9\-_]*[a-z0-9]\.{1})?[a-z0-9][a-z0-9\-_]{1,}[a-z0-9]@[a-z0-9][a-z0-9\-_]{4,}[a-z0-9]\.[a-z0-9]{2,4}$/gm)){
            console.log("ça match");
        }else{
            console.log("ça ne match pas");
        }

    }

</script>
</body>
</html>